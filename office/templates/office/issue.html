{% extends "office/layout.html" %}
{% load static %}
{% load i18n %}
{% load leaflet_tags %}
{% block head %}
    {% leaflet_js %}
    {% leaflet_css %}
    <script type="text/javascript">
    function map_init_basic (map, options) {
        //Setup leaflet map
        layer = L.geoJSON({{ position_geojson|safe }}).addTo(map);
        map.fitBounds(layer.getBounds());
        //centerLeafletMapOnMarker(map, marker);
    }
    function centerLeafletMapOnMarker(map, marker) {
      var latLngs = [ marker.getLatLng() ];
      var markerBounds = L.latLngBounds(latLngs);
      map.fitBounds(markerBounds);
    }
    </script>
{% endblock %}
{% block title %} {% trans "Issues" %}{% endblock %}
{% block content %}
<div class="container">
  <h2>Issue {{ issue.id }}
  {% if issue.published %}
    <i class="zmdi zmdi-eye" title='public visible'></i>
  {% else %}
    <i class="zmdi zmdi-eye-off" title='not public visible'></i>
  {% endif %}
  </h2>
  <p>{{ issue.category }}</p>
  
  <!-- Menus-->
  <ul class="nav nav-tabs">
    <li class="active"><a data-toggle="tab" href="#base">Base</a></li>
    <li><a data-toggle="tab" href="#comments">Comments</a></li>
    <li><a data-toggle="tab" href="#feedback">Feedback</a></li>
    <li><a data-toggle="tab" href="#history">History</a></li>
  </ul>

  <!-- Panes-->
  <div class="tab-content">
    <div id="base" class="tab-pane fade in active">
      <h3>Base</h3>
      <div class="row">
          <div class="col-md-8">
            <p>Author: 
                {% if author_trust_string == 'external' %}
                    <i class="zmdi zmdi-accounts" title="{{ author_trust_string }}"></i>
                {% elif author_trust_string == 'internal' %}
                    <i class="zmdi zmdi-city" title="{{ author_trust_string }}"></i>
                {% elif author_trust_string == 'fieldteam' %}
                    <i class="zmdi zmdi-walk" title="{{ author_trust_string }}"></i>
                {% endif %}
                {{ issue.authorEmail|default_if_none:"(removed)" }}
            </p>
            <p title="{{ issue.created_at }}">Created: {{ issue.created_at|date:"SHORT_DATE_FORMAT" }}</p>
            <q class="usertext">{{ issue.description }}</q>
            {% leaflet_map "issuemap" callback="window.map_init_basic" %}
            <!-- #TODO: Enable settings as overview map, overlays, ... -->
            <p>Location: {{ issue.location }}</p>
            <p>Landowner: {{ issue.landowner }}</p>
            <div class="bg-info">
                <p>Status: 
                    {% if status_string == 'submitted' %}
                        <i class="zmdi zmdi-email-open" title="{{ status_string }}"></i>
                    {% elif status_string == 'wip' %}
                        <i class="zmdi zmdi-puzzle-piece" title="{{ status_string }}"></i>
                    {% elif status_string == 'solved' %}
                        <i class="zmdi zmdi-check-circle" title="{{ status_string }}"></i>
                    {% elif status_string == 'impossible' %}
                        <span class="zmdi-hc-stack zmdi-hc-lg" title="{{ status_string }}">
                            <i class="zmdi zmdi-balance"></i>
                            <i class="zmdi zmdi-block zmdi-hc-stack-2x"></i>
                        </span> 
                    {% elif status_string == 'dublicate' %}
                        <i class="zmdi zmdi-check-copy" title="{{ status_string }}"></i>
                    {% endif %}
                    {{ status_string }}
                    -
                    {{ issue.status_created_at }}
                </p>
                <p>Status Text:
                    <q class="usertext">{{ issue.status_text|default_if_none:"(no text)" }}</q>
                </p>
            </div>
          </div>
          <div class="col-md-4">
            <img class="img-thumbnail" style="width:90%" src="{% get_media_prefix %}{{ issue.photo }}"/>
          </div>
        </div>
      <p></p>
    </div>
    <div id="comments" class="tab-pane fade">
      <h3>Internal Comments</h3>
      {% for comment in issue.comment_set.all %}
      <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">{{comment.author}} <small><i>Posted on {{comment.created_at|date:"SHORT_DATE_FORMAT" }}</i></small></h3>
          </div>
          <div class="panel-body">
            <q>{{comment.content}}</q>
          </div>
        </div>
        {% endfor %}
    </div>
    <div id="feedback" class="tab-pane fade">
      <h3>Public Feedback</h3>
        {% for feedback in issue.feedback_set.all %}
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">{{feedback.authorEmail}} <small><i>Written on {{feedback.created_at|date:"SHORT_DATE_FORMAT" }}</i></small></h3>
          </div>
          <div class="panel-body">
            <q>{{feedback.content}}</q>
          </div>
        </div>
        {% endfor %}

    </div>
    <div id="history" class="tab-pane fade">
      <h3>History</h3>
      <p>(here list alls edit history items)</p>
    </div>
  </div>
</div>
<div>
</div>
{% endblock %}
